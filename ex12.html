<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To Do List</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 30px 20px;
      background-color: #fdfdfd;
    }

    h1 {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .date {
      font-size: 1em;
      color: #666;
      margin-bottom: 20px;
    }

    .button-group {
      margin-bottom: 30px;
    }

    .button-group button {
      padding: 10px 20px;
      margin: 0 10px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .button-group button:hover {
      background-color: #45a049;
    }

    .todo-section, .calendar-section, .progress-section {
      margin-top: 20px;
      display: none;
    }

    .todo-section input, .calendar-input-section input {
      padding: 10px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .add-btn {
      padding: 10px 15px;
      font-size: 1em;
      margin-left: 10px;
      border: none;
      border-radius: 6px;
      background-color: #2196F3;
      color: white;
      cursor: pointer;
    }

    .todo-list, .schedule-list, #completed-list {
      margin-top: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }

    .todo-item, .schedule-item {
      background-color: #f2f2f2;
      padding: 15px 20px;
      margin-bottom: 15px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      border-left: 5px solid #2196F3;
    }

    .todo-left, .schedule-left {
      text-align: left;
    }

    .todo-title, .schedule-title {
      font-weight: bold;
      font-size: 1.2em;
    }

    .todo-time, .schedule-time {
      font-size: 0.9em;
      color: #777;
    }

    .todo-buttons button, .schedule-buttons button {
      margin-left: 8px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      color: white;
    }

    .complete-btn { background-color: #FFA500; }
    .delete-btn { background-color: #f44336; }

    .completed .todo-title, .completed .schedule-title {
      text-decoration: line-through;
      color: #aaa;
    }

    .completed {
      background-color: #e0e0e0;
      border-left: 5px solid #aaa;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      max-width: 600px;
      margin: 20px auto;
    }

    .calendar-grid .day-name {
      font-weight: bold;
      color: #555;
    }

    .calendar-grid button {
      padding: 10px;
      border: none;
      background-color: #eee;
      cursor: pointer;
      border-radius: 6px;
    }

    .calendar-grid button.today {
      background-color: #a4d4ff;
    }

    .calendar-grid button.selected {
      background-color: #2196F3;
      color: white;
    }

    .month-grid {
      margin-bottom: 20px;
    }

    .month-grid button {
      margin: 2px;
      padding: 8px 12px;
      border: none;
      background-color: #ddd;
      border-radius: 6px;
      cursor: pointer;
    }

    .month-grid button.active {
      background-color: #2196F3;
      color: white;
    }

    .calendar-input-section {
      margin-top: 20px;
    }

    /* progress-section 스타일 수정 */
    .progress-section {
      display: none;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      text-align: center;
    }

    #progress-chart {
      max-width: 200px;
      max-height: 200px;
      margin: 0 auto 20px;
      display: block;
    }

    #completed-list {
      margin-top: 10px;
      text-align: left;
    }

    .image-container img {
      max-width: 100%;
      height: auto;
      margin-top: 30px;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 2em;
      }
      .todo-title, .schedule-title {
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <h1>To Do List</h1>
  <div class="date" id="today-date"></div>

  <div class="button-group">
    <button onclick="showTodo()">목록</button>
    <button onclick="showCalendar()">달력</button>
    <button onclick="showProgress()">달성도</button>
  </div>

  <!-- Todo Section -->
  <div class="todo-section" id="todo-section">
    <input type="text" id="todo-input" placeholder="할 일을 입력하세요" />
    <button class="add-btn" onclick="addTodo()">추가</button>
    <div class="todo-list" id="todo-list"></div>
  </div>

  <!-- Calendar Section -->
  <div class="calendar-section" id="calendar-section">
    <div class="month-grid" id="month-grid"></div>
    <div class="calendar-grid" id="calendar-grid"></div>

    <div class="calendar-input-section">
      <input type="text" id="schedule-input" placeholder="일정을 입력하세요" />
      <button class="add-btn" onclick="addSchedule()">추가</button>
    </div>

    <div class="schedule-list" id="schedule-list"></div>
  </div>

  <!-- Progress Section -->
  <div class="progress-section" id="progress-section">
    <canvas id="progress-chart" width="200" height="200"></canvas>
    <div class="todo-list" id="completed-list"></div>
  </div>

  <div class="image-container">
    <img src="todolist-image.png" alt="이미지" />
  </div>

  <script>
    const today = new Date();
    const dayNames = ['일', '월', '화', '수', '목', '금', '토'];
    document.getElementById('today-date').textContent =
      `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}(${dayNames[today.getDay()]})`;

    const todoList = document.getElementById('todo-list');
    const completedList = document.getElementById('completed-list');

    function showTodo() {
      toggleSections('todo-section');
    }

    function showCalendar() {
      toggleSections('calendar-section');
      renderMonthGrid();
      renderCalendarDays();
      renderSchedules();
    }

    function showProgress() {
      toggleSections('progress-section');

      // 전체 할 일과 완료된 할 일 수 세기
      const total = document.querySelectorAll('.todo-item').length;
      const completed = document.querySelectorAll('.todo-item.completed').length;
      const percent = total ? Math.round((completed / total) * 100) : 0;

      renderProgressChart(percent);

      // 완료 목록 렌더링
      renderCompletedList();

      // 완료 목록이 없으면 안내 문구 표시
      if (completed === 0) {
        completedList.innerHTML = '<p>완료된 할 일이 없습니다.</p>';
      }
    }

    function toggleSections(visibleId) {
      ['todo-section', 'calendar-section', 'progress-section'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.style.display = id === visibleId ? 'block' : 'none';
        }
      });
    }

    function getCurrentTime() {
      const now = new Date();
      return `생성: ${now.getFullYear()}. ${now.getMonth() + 1}. ${now.getDate()} ${now.toLocaleTimeString('ko-KR')}`;
    }

    function addTodo() {
      const input = document.getElementById('todo-input');
      const value = input.value.trim();
      if (!value) return;

      const item = createTodoItem(value);
      todoList.appendChild(item);
      input.value = '';
    }

    function createTodoItem(value) {
      const item = document.createElement('div');
      item.className = 'todo-item';

      const left = document.createElement('div');
      left.className = 'todo-left';

      const title = document.createElement('div');
      title.className = 'todo-title';
      title.textContent = value;

      const time = document.createElement('div');
      time.className = 'todo-time';
      time.textContent = getCurrentTime();

      left.appendChild(title);
      left.appendChild(time);

      const buttons = document.createElement('div');
      buttons.className = 'todo-buttons';

      const completeBtn = document.createElement('button');
      completeBtn.className = 'complete-btn';
      completeBtn.textContent = '완료';
      completeBtn.onclick = () => {
        item.classList.toggle('completed');
        completeBtn.textContent = item.classList.contains('completed') ? '취소' : '완료';
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'delete-btn';
      deleteBtn.textContent = '삭제';
      deleteBtn.onclick = () => item.remove();

      buttons.appendChild(completeBtn);
      buttons.appendChild(deleteBtn);

      item.appendChild(left);
      item.appendChild(buttons);

      return item;
    }

    // 달력 기능
    let selectedDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());

    function renderMonthGrid() {
      const monthGrid = document.getElementById('month-grid');
      monthGrid.innerHTML = '';
      for(let m=0; m<12; m++) {
        const btn = document.createElement('button');
        btn.textContent = `${m+1}월`;
        btn.className = m === selectedDate.getMonth() ? 'active' : '';
        btn.onclick = () => {
          selectedDate.setMonth(m);
          renderMonthGrid();
          renderCalendarDays();
          renderSchedules();
        };
        monthGrid.appendChild(btn);
      }
    }

    function renderCalendarDays() {
      const calendarGrid = document.getElementById('calendar-grid');
      calendarGrid.innerHTML = '';

      // 요일 표시
      dayNames.forEach(day => {
        const dayEl = document.createElement('div');
        dayEl.textContent = day;
        dayEl.className = 'day-name';
        calendarGrid.appendChild(dayEl);
      });

      const year = selectedDate.getFullYear();
      const month = selectedDate.getMonth();

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);

      const startDay = firstDay.getDay();
      const totalDays = lastDay.getDate();

      // 빈 칸 채우기
      for(let i=0; i < startDay; i++) {
        const empty = document.createElement('div');
        calendarGrid.appendChild(empty);
      }

      for(let day=1; day <= totalDays; day++) {
        const btn = document.createElement('button');
        btn.textContent = day;

        // 오늘 날짜 표시
        const isToday = year === today.getFullYear() && month === today.getMonth() && day === today.getDate();
        if(isToday) btn.classList.add('today');

        // 선택된 날짜 표시
        if(day === selectedDate.getDate()) btn.classList.add('selected');

        btn.onclick = () => {
          selectedDate.setDate(day);
          renderCalendarDays();
          renderSchedules();
        };

        calendarGrid.appendChild(btn);
      }
    }

    // 스케줄 저장 구조
    let schedules = {};

    function addSchedule() {
      const scheduleInput = document.getElementById('schedule-input');
      const val = scheduleInput.value.trim();
      if(!val) return;

      const key = getScheduleKey(selectedDate);
      if(!schedules[key]) {
        schedules[key] = [];
      }
      schedules[key].push(val);
      scheduleInput.value = '';

      renderSchedules();
    }

    function getScheduleKey(date) {
      return `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;
    }

    function renderSchedules() {
      const scheduleList = document.getElementById('schedule-list');
      scheduleList.innerHTML = '';

      const key = getScheduleKey(selectedDate);
      if(!schedules[key] || schedules[key].length === 0) {
        scheduleList.textContent = '해당 날짜에 일정이 없습니다.';
        return;
      }

      schedules[key].forEach((sch, idx) => {
        const item = document.createElement('div');
        item.className = 'schedule-item';

        const left = document.createElement('div');
        left.className = 'schedule-left';

        const title = document.createElement('div');
        title.className = 'schedule-title';
        title.textContent = sch;

        const time = document.createElement('div');
        time.className = 'schedule-time';
        time.textContent = getCurrentTime();

        left.appendChild(title);
        left.appendChild(time);

        const buttons = document.createElement('div');
        buttons.className = 'schedule-buttons';

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = '삭제';
        deleteBtn.onclick = () => {
          schedules[key].splice(idx, 1);
          renderSchedules();
        };

        buttons.appendChild(deleteBtn);

        item.appendChild(left);
        item.appendChild(buttons);

        scheduleList.appendChild(item);
      });
    }

    // 달성도 차트 렌더링
    let chartInstance = null;
    function renderProgressChart(percent) {
      const ctx = document.getElementById('progress-chart').getContext('2d');

      if(chartInstance) {
        chartInstance.destroy();
      }

      chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['완료', '미완료'],
          datasets: [{
            label: '할 일 달성도',
            data: [percent, 100 - percent],
            backgroundColor: ['#4CAF50', '#ddd'],
            borderWidth: 0,
          }]
        },
        options: {
          cutout: '70%',
          responsive: false,
          plugins: {
            legend: { display: true },
            tooltip: { enabled: true },
            title: {
              display: true,
              text: `달성도: ${percent}%`
            }
          }
        }
      });
    }

    // 완료 목록 렌더링
    function renderCompletedList() {
      completedList.innerHTML = '';

      const completedItems = document.querySelectorAll('.todo-item.completed');
      if(completedItems.length === 0) {
        completedList.innerHTML = '<p>완료된 할 일이 없습니다.</p>';
        return;
      }

      completedItems.forEach(item => {
        const clone = item.cloneNode(true);
        clone.querySelector('.todo-buttons').remove(); // 완료, 삭제 버튼 없애기
        clone.style.borderLeft = '5px solid #4CAF50';
        completedList.appendChild(clone);
      });
    }

    // 초기 화면: Todo 목록 보여주기
    showTodo();
  </script>
</body>
</html>
